gbd_df <- NULL
for (ag in 1:length(unique(i_data$age))){
for (gender in c("Male", "Female")){
age_sex_df <- NULL
for (dm in 1:length(disease_measures_list)){
for (d in 1:nrow(disease_short_names)){
dn <- disease_short_names$disease[d]
dmeasure <- disease_measures_list[dm] %>% as.character()
agroup <- unique(i_data$age)[ag]
idf <- dplyr::filter(i_data, sex == gender & age == agroup & measure == dmeasure & cause == dn)
if (nrow(idf) > 0){
population_numbers <- dplyr::filter(idf, metric == "Number") %>% select("val")
idf_rate <- dplyr::filter(idf, metric == "Rate") %>% select("val")
current_idf_rate <- idf_rate
current_population_numbers <- population_numbers
idf$population_number <- 0
if (idf_rate$val != 0 && population_numbers$val != 0)
idf$population_number <- (100000 * population_numbers$val) / idf_rate$val
else{
current_idf_rate <- idf_rate
current_population_numbers <- population_numbers
idf <- dplyr::filter(i_data, sex == gender & age == agroup & measure == dmeasure & val > 0)
idf <- dplyr::filter(idf, cause == unique(idf$cause)[1])
idf$cause <- dn
population_numbers <- dplyr::filter(idf, metric == "Number") %>% select("val")
idf_rate <- dplyr::filter(idf, metric == "Rate") %>% select("val")
idf$population_number <- 0
if (idf_rate$val != 0 && population_numbers$val != 0)
idf$population_number <- (100000 * population_numbers$val) / idf_rate$val
}
idf$rate_per_1 <- round(current_idf_rate$val / 100000, 6)
idf[[tolower(paste(dmeasure, "rate", disease_short_names$sname[d], sep = "_"))]] <- idf$rate_per_1
idf[[tolower(paste(dmeasure, "number", disease_short_names$sname[d], sep = "_"))]] <- current_population_numbers$val
idf <- dplyr::filter(idf, metric == "Number")
if (is.null(age_sex_df)){
age_sex_df <- select(idf, age, sex, population_number, location, names(idf)[ncol(idf) - 1] , names(idf)[ncol(idf)])
}
else{
age_sex_df <- cbind(age_sex_df, select(idf, names(idf)[ncol(idf) - 1] , names(idf)[ncol(idf)]))
}
}
}
}
if (is.null(gbd_df)){
gbd_df <- age_sex_df
}
else{
age_sex_df[setdiff(names(gbd_df), names(age_sex_df))] <- 0
gbd_df[setdiff(names(age_sex_df), names(gbd_df))] <- 0
gbd_df <- rbind(gbd_df, age_sex_df)
}
}
}
return(gbd_df)
}
test_df <- city_regions_list_loc[[1]]
test_df <- city_regions_list_loc[[1]][1]
test_df <- as.data.frame(city_regions_list_loc[[1]][1])
test_df <- city_regions_list_loc[[1]][1] %>% as.data.frame()
View(city_regions_list_loc)
View(city_regions_list_loc)
city_regions_list <- split(gbd_input , f = gbd_input$cityregion)
city_regions_list_loc <- list()
for (i in 1:length(city_regions_list)){
city_regions_list_loc[[i]] <- split(city_regions_list[[i]], f = city_regions_list[[i]]$location)
## Hard coded now, change to pick up names from city regions
# names(city_regions_list_loc) <- c("bristol", "greatermanchester", "leeds", "liverpool", "london", "northeast", "nottingham", "sheffield", "westmidlands")
}
test_df <- city_regions_list_loc[[1]][[1]] %>% as.data.frame()
gbd_loc_data_processed <- lapply(test_df, RunLocDf)
RunLocDf <- function(i_data) {
gbd_df <- NULL
for (ag in 1:length(unique(i_data[["age"]]))){
for (gender in c("Male", "Female")){
age_sex_df <- NULL
for (dm in 1:length(disease_measures_list)){
for (d in 1:nrow(disease_short_names)){
dn <- disease_short_names$disease[d]
dmeasure <- disease_measures_list[dm] %>% as.character()
agroup <- unique(i_data[["age"]])[ag]
idf <- dplyr::filter(i_data, sex == gender & age == agroup & measure == dmeasure & cause == dn)
if (nrow(idf) > 0){
population_numbers <- dplyr::filter(idf, metric == "Number") %>% select("val")
idf_rate <- dplyr::filter(idf, metric == "Rate") %>% select("val")
current_idf_rate <- idf_rate
current_population_numbers <- population_numbers
idf$population_number <- 0
if (idf_rate$val != 0 && population_numbers$val != 0)
idf$population_number <- (100000 * population_numbers$val) / idf_rate$val
else{
current_idf_rate <- idf_rate
current_population_numbers <- population_numbers
idf <- dplyr::filter(i_data, sex == gender & age == agroup & measure == dmeasure & val > 0)
idf <- dplyr::filter(idf, cause == unique(idf$cause)[1])
idf$cause <- dn
population_numbers <- dplyr::filter(idf, metric == "Number") %>% select("val")
idf_rate <- dplyr::filter(idf, metric == "Rate") %>% select("val")
idf$population_number <- 0
if (idf_rate$val != 0 && population_numbers$val != 0)
idf$population_number <- (100000 * population_numbers$val) / idf_rate$val
}
idf$rate_per_1 <- round(current_idf_rate$val / 100000, 6)
idf[[tolower(paste(dmeasure, "rate", disease_short_names$sname[d], sep = "_"))]] <- idf$rate_per_1
idf[[tolower(paste(dmeasure, "number", disease_short_names$sname[d], sep = "_"))]] <- current_population_numbers$val
idf <- dplyr::filter(idf, metric == "Number")
if (is.null(age_sex_df)){
age_sex_df <- select(idf, age, sex, population_number, location, names(idf)[ncol(idf) - 1] , names(idf)[ncol(idf)])
}
else{
age_sex_df <- cbind(age_sex_df, select(idf, names(idf)[ncol(idf) - 1] , names(idf)[ncol(idf)]))
}
}
}
}
if (is.null(gbd_df)){
gbd_df <- age_sex_df
}
else{
age_sex_df[setdiff(names(gbd_df), names(age_sex_df))] <- 0
gbd_df[setdiff(names(age_sex_df), names(gbd_df))] <- 0
gbd_df <- rbind(gbd_df, age_sex_df)
}
}
}
return(gbd_df)
}
RunLocDf <- function(i_data) {
gbd_df <- NULL
for (ag in 1:length(unique(i_data[["age"]]))){
for (gender in c("Male", "Female")){
age_sex_df <- NULL
for (dm in 1:length(disease_measures_list)){
for (d in 1:nrow(disease_short_names)){
dn <- disease_short_names$disease[d]
dmeasure <- disease_measures_list[dm] %>% as.character()
agroup <- unique(i_data[["age"]])[ag]
idf <- dplyr::filter(i_data, sex == gender & age == agroup & measure == dmeasure & cause == dn)
if (nrow(idf) > 0){
population_numbers <- dplyr::filter(idf, metric == "Number") %>% select("val")
idf_rate <- dplyr::filter(idf, metric == "Rate") %>% select("val")
current_idf_rate <- idf_rate
current_population_numbers <- population_numbers
idf$population_number <- 0
if (idf_rate$val != 0 && population_numbers$val != 0)
idf$population_number <- (100000 * population_numbers$val) / idf_rate$val
else{
current_idf_rate <- idf_rate
current_population_numbers <- population_numbers
idf <- dplyr::filter(i_data, sex == gender & age == agroup & measure == dmeasure & val > 0)
idf <- dplyr::filter(idf, cause == unique(idf$cause)[1])
idf$cause <- dn
population_numbers <- dplyr::filter(idf, metric == "Number") %>% select("val")
idf_rate <- dplyr::filter(idf, metric == "Rate") %>% select("val")
idf$population_number <- 0
if (idf_rate$val != 0 && population_numbers$val != 0)
idf$population_number <- (100000 * population_numbers$val) / idf_rate$val
}
idf$rate_per_1 <- round(current_idf_rate$val / 100000, 6)
idf[[tolower(paste(dmeasure, "rate", disease_short_names$sname[d], sep = "_"))]] <- idf$rate_per_1
idf[[tolower(paste(dmeasure, "number", disease_short_names$sname[d], sep = "_"))]] <- current_population_numbers$val
idf <- dplyr::filter(idf, metric == "Number")
if (is.null(age_sex_df)){
age_sex_df <- select(idf, age, sex, population_number, location, names(idf)[ncol(idf) - 1] , names(idf)[ncol(idf)])
}
else{
age_sex_df <- cbind(age_sex_df, select(idf, names(idf)[ncol(idf) - 1] , names(idf)[ncol(idf)]))
}
}
}
}
if (is.null(gbd_df)){
gbd_df <- age_sex_df
}
else{
age_sex_df[setdiff(names(gbd_df), names(age_sex_df))] <- 0
gbd_df[setdiff(names(age_sex_df), names(gbd_df))] <- 0
gbd_df <- rbind(gbd_df, age_sex_df)
}
}
}
return(gbd_df)
}
gbd_loc_data_processed <- lapply(test_df, RunLocDf)
gbd_input <- dplyr::select(gbd_input) %>% filter(year == 2017)
gbd_input <- data_extracted
# ---- chunk-2.1: Clean data ----
names(gbd_input) = gsub(pattern = "_name", replacement = "", x = names(gbd_input))
gbd_input <- select(gbd_input,-contains("id"))
gbd_input <- filter(gbd_input, location %in% localities) %>% mutate_if(is.factor, as.character)
gbd_input$cause <- tolower(gbd_input$cause)
gbd_input <- left_join(local_goverment_areas, gbd_input, by = "location")
gbd_input <- gbd_input[which(gbd_input$year== in_year)
gbd_input <- gbd_input[which(gbd_input$year== in_year),]
gbd_input <- gbd_input[which(gbd_input$year== 2017),]
gbd_input <- gbd_input[which(gbd_input$year== 2017),]
city_regions_list <- split(gbd_input , f = gbd_input$cityregion)
city_regions_list_loc <- list()
for (i in 1:length(city_regions_list)){
city_regions_list_loc[[i]] <- split(city_regions_list[[i]], f = city_regions_list[[i]]$location)
## Hard coded now, change to pick up names from city regions
# names(city_regions_list_loc) <- c("bristol", "greatermanchester", "leeds", "liverpool", "london", "northeast", "nottingham", "sheffield", "westmidlands")
}
test_df <- city_regions_list_loc[[1]][[1]] %>% as.data.frame()
gbd_loc_data_processed <- lapply(test_df, RunLocDf)
test_df <- city_regions_list_loc[[1]]
gbd_loc_data_processed <- lapply(test_df, RunLocDf)
gbd_loc_data_processed <- NULL
gbd_loc_data_processed <- NULL
for (i in length(city_regions_list_loc))
gbd_loc_data_processed <- lapply(city_regions_list_loc[[i]], RunLocDf)
}
gbd_loc_data_processed <- NULL
for (i in length(city_regions_list_loc)) {
gbd_loc_data_processed <- lapply(city_regions_list_loc[[i]], RunLocDf)
}
View(gbd_loc_data_processed)
gbd_loc_data_processed <- NULL
for (i in 1:length(city_regions_list_loc)) {
gbd_loc_data_processed <- lapply(city_regions_list_loc[[i]], RunLocDf)
}
for (i in city_regions_list_loc) {
gbd_loc_data_processed[[i]] <- lapply(city_regions_list_loc, RunLocDf)
}
gbd_loc_data_processed <- NULL
for (i in 1:length(city_regions_list_loc)) {
gbd_loc_data_processed <- lapply(city_regions_list_loc[[i]], RunLocDf)
}
index <- 1
gbd_loc_data_processed <- NULL
for (i in 1:length(city_regions_list_loc)) {
gbd_loc_data_processed[[index]] <- lapply(city_regions_list_loc[[i]], RunLocDf)
index <- index + 1
}
index <- 1
gbd_loc_data_processed <- list()
for (i in 1:length(city_regions_list_loc)) {
gbd_loc_data_processed[[index]] <- lapply(city_regions_list_loc[[i]], RunLocDf)
index <- index + 1
}
View(city_regions_list_loc)
View(gbd_loc_data_processed)
index <- 1
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_loc_data_processed[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number')
index <- index + 1
}
index <- 1
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number')
index <- index + 1
}
index <- 1
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number')
index <- index + 1
}
View(gbd_city_region_data)
View(gbd_city_region_data[[1]])
index <- 1
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number')
gbd_city_region_data[[index]] <- dplyr::select(gbd_city_region_data[[index]], -contains('rate'))
gbd_city_region_data[[index]] <-   gbd_city_region_data[[index]] %>% mutate_if(is.factor, as.character)
gbd_city_region_data[[index]]$sex_age_cat <- paste(gbd_city_region_data[[index]]$sex, gbd_city_region_data[[index]]$age, sep = "_")
gbd_city_region_data[[index]] <- select(gbd_city_region_data[[index]], -c(age, sex, location, number))
index <- index + 1
}
gbd_city_region_data <- list()
## Add up number and then calculate rates from numbers and population numbers.
### include all code below to prepare data sets per city regions in one loop only
index <- 1
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number')
gbd_city_region_data[[index]] <- dplyr::select(gbd_city_region_data[[index]], -contains('rate'))
gbd_city_region_data[[index]] <-   gbd_city_region_data[[index]] %>% mutate_if(is.factor, as.character)
gbd_city_region_data[[index]]$sex_age_cat <- paste(gbd_city_region_data[[index]]$sex, gbd_city_region_data[[index]]$age, sep = "_")
gbd_city_region_data[[index]] <- select(gbd_city_region_data[[index]], -c(age, sex, location, number))
index <- index + 1
}
index <- 1
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number')
}
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number') %>%
dplyr::select(gbd_city_region_data[[index]], -contains('rate'))
View(gbd_city_region_data[[1]])
View(gbd_city_region_data[[1]])
index <- 1
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number') %>%
dplyr::select(gbd_city_region_data[[index]], -contains('rate'))
}
index <- 1
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number') %>%
# dplyr::select(gbd_city_region_data[[index]], -contains('rate'))
}
index <- 1
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number')
# %>% dplyr::select(gbd_city_region_data[[index]], -contains('rate'))
}
View(gbd_city_region_data[[1]])
index <- 1
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number')
%>% -contains('rate')
}
index <- 1
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number') %>% -contains('rate')
}
index <- 1
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number') %>%
select(gbd_city_region_data[[index]],-contains('rate'))
}
index <- 1
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number')
}
for (i in 1:length(gbd_city_region_data)) {
gbd_city_region_data[[i]] <- select(gbd_city_region_data[[i]],-contains('rate'))
gbd_city_region_data[[i]] <-   gbd_city_region_data[[index]] %>% mutate_if(is.factor, as.character)
gbd_city_region_data[[i]]$sex_age_cat <- paste(gbd_city_region_data[[i]]$sex, gbd_city_region_data[[i]]$age, sep = "_")
gbd_city_region_data[[i]] <- select(gbd_city_region_data[[i]], -c(age, sex, location, number))
}
for (i in 1:length(gbd_city_region_data)) {
data <- gbd_city_region_data[[i]]
data <- select(data,-contains('rate'))
}
index <- 1
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number')
}
index <- 1
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number')
data <- gbd_city_region_data[[index]]
}
index <- 1
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number')
data <- gbd_city_region_data[[index]] %>% select(data, -contains('rate'))
}
test <- gbd_city_region_data[[1]]
test <- gbd_city_region_data[[1]]  %>% select(test, -contains('rate'))
test <- gbd_city_region_data[[1]]  %>% dplyr::select(test, -contains('rate'))
test <- dplyr::select(test, -contains('rate'))
rlang::last_error()
data <- select(data,-contains("rate"))
# View(gbd_city_region_data[[1]])
test <- gbd_city_region_data[[1]]
test <- dplyr::select(test, -contains("rate"))
index <- 1
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number')
index <- index + 1
}
index <- 1
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number')
gbd_city_region_data[[index]] <- dplyr::select(gbd_city_region_data[[index]], -contains("rate"))
index <- index + 1
}
index <- 1
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number')
# gbd_city_region_data[[index]] <- dplyr::select(gbd_city_region_data[[index]], -contains("rate"))
index <- index + 1
}
index <- 1
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number')
# gbd_city_region_data[[index]] <- dplyr::select(gbd_city_region_data[[index]], -contains("rate"))
index <- index + 1
}
### include all code below to prepare data sets per city regions in one loop only
index <- 1
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number') %>% mutate_if(is.factor, as.character)
# gbd_city_region_data[[index]] <- dplyr::select(gbd_city_region_data[[index]], -contains("rate"))
index <- index + 1
}
index <- 1
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number')
dplyr::select(gbd_city_region_data[[index]], -contains("rate"))
index <- index + 1
}
View(gbd_city_region_data)
index <- 1
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number')
# dplyr::select(gbd_city_region_data[[index]], -contains("rate"))
index <- index + 1
}
View(gbd_city_region_data)
index <- 1
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number')
dplyr::select(gbd_city_region_data[[i]], -contains("rate"))
index <- index + 1
}
index <- 1
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number')
# dplyr::select(gbd_city_region_data[[i]], -contains("rate"))
index <- index + 1
}
for (i in length(gbd_city_region_data))  {
gbd_city_region_data[[i]] <-   gbd_city_region_data[[i]] %>% mutate_if(is.factor, as.character)
gbd_city_region_data[[i]]$sex_age_cat <- paste(gbd_city_region_data[[i]]$sex, gbd_city_region_data[[i]]$age, sep = "_")
gbd_city_region_data[[i]] <- select(gbd_city_region_data[[i]], -c(age, sex, location, number))
}
for (i in length(gbd_city_region_data))  {
gbd_city_region_data[i] <-   gbd_city_region_data[i] %>% mutate_if(is.factor, as.character)
gbd_city_region_data[i]$sex_age_cat <- paste(gbd_city_region_data[i]$sex, gbd_city_region_data[i]$age, sep = "_")
gbd_city_region_data[i] <- select(gbd_city_region_data[i], -c(age, sex, location, number))
}
for (i in 1:length(gbd_city_region_data))  {
gbd_city_region_data[i] <-   gbd_city_region_data[i] %>% mutate_if(is.factor, as.character)
gbd_city_region_data[i]$sex_age_cat <- paste(gbd_city_region_data[i]$sex, gbd_city_region_data[i]$age, sep = "_")
gbd_city_region_data[i] <- select(gbd_city_region_data[i], -c(age, sex, location, number))
}
for (i in 1:length(gbd_city_region_data))  {
gbd_city_region_data[[i]] <-   gbd_city_region_data[[i]] %>% mutate_if(is.factor, as.character)
gbd_city_region_data[[i]]$sex_age_cat <- paste(gbd_city_region_data[[i]]$sex, gbd_city_region_data[i]$age, sep = "_")
gbd_city_region_data[[i]] <- select(gbd_city_region_data[[i]], -c(age, sex, location, number))
}
index <- 1
gbd_city_region_data_1 <- list()
for (i in 1:length(gbd_city_region_data))  {
gbd_city_region_data[[index]] <-   gbd_city_region_data[[i]] %>% mutate_if(is.factor, as.character)
gbd_city_region_data[[index]]$sex_age_cat <- paste(gbd_city_region_data[[i]]$sex, gbd_city_region_data[i]$age, sep = "_")
gbd_city_region_data[[index]] <- select(gbd_city_region_data[[i]], -c(age, sex, location, number))
index <- index + 1
}
index <- 1
gbd_city_region_data_1 <- list()
for (i in 1:length(gbd_city_region_data))  {
gbd_city_region_data_1[[index]] <-   gbd_city_region_data[[i]] %>% mutate_if(is.factor, as.character)
gbd_city_region_data_1[[index]]$sex_age_cat <- paste(gbd_city_region_data[[i]]$sex, gbd_city_region_data[i]$age, sep = "_")
gbd_city_region_data_1[[index]] <- select(gbd_city_region_data[[i]], -c(age, sex, location, number))
index <- index + 1
}
index <- 1
gbd_city_region_data_1 <- list()
for (i in 1:length(gbd_city_region_data))  {
gbd_city_region_data_1[[index]] <- dplyr::select(gbd_city_region_data[[i]], -contains('rate'))
gbd_city_region_data_1[[index]] <-   gbd_city_region_data[[i]] %>% mutate_if(is.factor, as.character)
gbd_city_region_data_1[[index]]$sex_age_cat <- paste(gbd_city_region_data[[i]]$sex, gbd_city_region_data[i]$age, sep = "_")
gbd_city_region_data_1[[index]] <- select(gbd_city_region_data[[i]], -c(age, sex, location, number))
index <- index + 1
}
index <- 1
gbd_city_region_data <- list()
for (i in 1:length(gbd_loc_data_processed)) {
gbd_city_region_data[[index]] <- bind_rows(gbd_loc_data_processed[[i]], .id = 'number')
index <- index + 1
}
test <- gbd_city_region_data[[1]]
view(test)
test <- gbd_city_region_data[[1]]
test <- dplyr::select(test, -contains('rate'))
test <- dplyr::select(test, -contains('rate'))
rlang::last_error()
View(test)
names(test)[has_dupe_col]
tibble::enframe(names(test)) %>% count("rate") %>% filter(n > 1)
names(test)
test <- dplyr::select(test, -contains('rate-'))
test <- dplyr::select(test, -contains('rate_'))
tibble::enframe(names(test)) %>% count("rate") %>% filter(n > 1)
str(test)
test <- dplyr::select(test, -contains("rate"))
group <- dplyr::select(test, contains("rate"))
group <- select(test, contains("rate"))
group <- select(test, everything("rate"))
test[, contains('rate') == names(test)] <- NULL
test2 <- test %>%
dplyr::select(-contains("rate"))
test2 <- test %>%
dplyr::subset(-contains("rate"))
test2 <- test %>%
subset(-contains("rate"))
