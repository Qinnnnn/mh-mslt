index <- 1
disease_relative_risks <- list(c(DIABETES_IHD_RR_M,DIABETES_IHD_RR_F),
c(DIABETES_STROKE_RR_M,DIABETES_STROKE_RR_F))
##!! diabetes must be calculated before stroke and ihd
ishd_index <- which(DISEASE_SHORT_NAMES$sname=='ishd')
strk_index <- which(DISEASE_SHORT_NAMES$sname=='strk')
dia_index <- which(DISEASE_SHORT_NAMES$sname=='dmt2')
dia_order <- c(dia_index,c(1:nrow(DISEASE_SHORT_NAMES))[-dia_index])
for (iage in i_age_cohort){
td1_age <- MSLT_DF[MSLT_DF$age>=iage,]
pif_disease_age <- pif_expanded[pif_expanded$age>=iage,]
for (isex in i_sex){
td1_age_sex <- td1_age[td1_age$sex==isex,]
pif_disease_age_sex <- pif_disease_age[pif_disease_age$sex==isex,]
for (d in c(1:nrow(DISEASE_SHORT_NAMES))[dia_order]){
## Exclude non-males diseases and non-chronic diseases and road injuries and disease with no pif
if (isex == 'male' && (DISEASE_SHORT_NAMES$disease[d] %in% c('breast cancer', 'uterine cancer'))||
DISEASE_SHORT_NAMES$is_not_dis[d] != 0 || DISEASE_SHORT_NAMES$acronym[d] == 'no_pif' || DISEASE_SHORT_NAMES$acronym[d] == 'other'){
} else {
pif_colname <- paste0('pif_',DISEASE_SHORT_NAMES$acronym[d])
pif_disease <- pif_disease_age_sex[,colnames(pif_disease_age_sex) %in% c('age', 'sex', pif_colname)]
# adjustment for diabetes effect on ihd and stroke
if(d %in% c(ishd_index,strk_index)){
# select which disease
which_disease <- which(c(ishd_index,strk_index)==d)
# get name for pif column
target_disease <- c('pif_ihd','pif_stroke')[which_disease]
# get diabetes label, just made
dia_col <- paste0(iage,'_',isex,'_dmt2')
# select relative risk of disease given diabetes (depends on sex, not age)
relative_risk <- disease_relative_risks[[which_disease]][which(i_sex==isex)]
# (store old pif)
old_pif <- pif_disease[[target_disease]]
# diabetes pif = - { scenario prevalence - baseline prevalence } * (RR - 1)  / { baseline prevalence * (RR - 1) + 1 }
pif_dia <- -(disease_life_table_list_sc[[dia_col]]$px - disease_life_table_list_bl[[dia_col]]$px)*(relative_risk-1)/
(disease_life_table_list_bl[[dia_col]]$px * (relative_risk-1) + 1)
# modify pif for target disease: new pif =  (1 - old pif) * (1 - diabetes pif)
pif_disease[[target_disease]] <- 1- (1-pif_disease[[target_disease]]) * (1-pif_dia)
# print(sum(old_pif-pif_disease[[target_disease]]))
}
new_col <- td1_age_sex[[paste('incidence', DISEASE_SHORT_NAMES$sname[d], sep = '_')]] * (1 - (pif_disease[[pif_colname]]))
new_col[is.na(new_col)] <- 0
td1_age_sex[[paste('incidence', DISEASE_SHORT_NAMES$sname[d], sep = '_')]] <- new_col
## Instead of idata, feed td to run scenarios. Now all diseases are run again, with the effect of diabetes
## on cardiovarcular diseases taken into account.
disease_life_table_list_sc_temp <- RunDisease(in_idata = td1_age_sex, in_sex = isex,
in_mid_age = iage, in_disease = DISEASE_SHORT_NAMES$sname[d])
disease_life_table_list_sc_temp$diff_inc_disease <-
disease_life_table_list_sc_temp$incidence_disease -   disease_life_table_list_bl[[index]]$incidence_disease
disease_life_table_list_sc_temp$diff_prev_disease <-
disease_life_table_list_sc_temp$px  - disease_life_table_list_bl[[index]]$px
disease_life_table_list_sc_temp$diff_mort_disease <-
disease_life_table_list_sc_temp$mx - disease_life_table_list_bl[[index]]$mx
disease_life_table_list_sc_temp$diff_pylds_disease <-
(disease_life_table_list_sc_temp$px - disease_life_table_list_bl[[index]]$px) * disease_life_table_list_bl[[index]]$dw_disease
disease_life_table_list_sc[[index]] <- disease_life_table_list_sc_temp
names(disease_life_table_list_sc)[index] <- paste(iage, isex, DISEASE_SHORT_NAMES$sname[d], sep = '_')
index <- index + 1
}
}
}
}
## Uncommnet to check scenario life tables
# View(disease_life_table_list_sc[[3]])
# ---- chunk-8 ----
## Generate total change in mortality rate to recalculate scenario general life tables
### Vector in common by all calculations for change in mx and pylds.
index <- 1
age_sex_cols <- which(colnames(disease_life_table_list_sc[[index]])%in%c('age', 'sex'))
### Sum mortality rate change scenarios (mx_sc_total)
#### Diseases
mx_sc_total_disease <- list()
l_index <- 1
index <- 1
for (iage in i_age_cohort){
for (isex in i_sex){
mortality_sum <- NULL
create_new <- T
## Sum all diseases mortality rates
for (d in 1:nrow(DISEASE_SHORT_NAMES)) {
if (isex == 'male' && (DISEASE_SHORT_NAMES$disease[d] %in% c('breast cancer', 'uterine cancer'))
|| DISEASE_SHORT_NAMES$is_not_dis[d] != 0 || DISEASE_SHORT_NAMES$acronym[d] == 'no_pif' || DISEASE_SHORT_NAMES$acronym[d] == 'other'){
}
else {
# print(paste(isex, DISEASE_SHORT_NAMES$disease[d]))
if (create_new){
mortality_sum <- disease_life_table_list_sc[[index]][,age_sex_cols]
mortality_sum$total <- 0
create_new <- F
mortality_sum$total <- mortality_sum$total +
(disease_life_table_list_sc[[index]]$diff_mort_disease)
}else{
mortality_sum$total <- mortality_sum$total +
(disease_life_table_list_sc[[index]]$diff_mort_disease)
}
# cat(age, ' - ', sex,' - ',  disease,' - ',  index, ' - ', l_index,  '\n')
index <- index + 1
}
}
mx_sc_total_disease[[l_index]] <- mortality_sum
names(mx_sc_total_disease)[l_index] <- paste(iage, isex)
l_index <- l_index + 1
}
}
#### NonDiseases (road injuries and lri)
mx_sc_total_non_disease <- list()
l_index <- 1
index <- 1
for (iage in i_age_cohort){
for (isex in i_sex){
mortality_sum <- NULL
mortality_sum1 <- NULL
create_new <- T
## Sum all non_diseases mortality rates
for (d in 1:nrow(DISEASE_SHORT_NAMES)) {
if (DISEASE_SHORT_NAMES$is_not_dis[d] != 1 || DISEASE_SHORT_NAMES$acronym[d] == 'no_pif' || DISEASE_SHORT_NAMES$acronym[d] == 'other'){
}
else {
# print(paste(isex, DISEASE_SHORT_NAMES$disease[d]))
if (create_new){
mortality_sum <- non_disease_list[[index]][,age_sex_cols]
mortality_sum$total <- 0
create_new <- F
mortality_sum$total <- mortality_sum$total +
(non_disease_list[[index]]$diff_mort)
}else{
mortality_sum$total <- mortality_sum$total +
(non_disease_list[[index]]$diff_mort)
}
# cat(age, ' - ', sex,' - ',  disease,' - ',  index, ' - ', l_index,  '\n')
index <- index + 1
}
}
mx_sc_total_non_disease[[l_index]] <- mortality_sum
names(mx_sc_total_non_disease)[l_index] <- paste(iage, isex)
l_index <- l_index + 1
}
}
## YLDs change
### Diseases
pylds_sc_total_disease <- list()
l_index <- 1
index <- 1
for (iage in i_age_cohort){
for (isex in i_sex){
pylds_sum <- NULL
create_new <- T
for (d in 1:nrow(DISEASE_SHORT_NAMES)) {
if (isex == 'male' && (DISEASE_SHORT_NAMES$disease[d] %in% c('breast cancer', 'uterine cancer'))
|| DISEASE_SHORT_NAMES$is_not_dis[d] != 0 || DISEASE_SHORT_NAMES$acronym[d] == 'no_pif' || DISEASE_SHORT_NAMES$acronym[d] == 'other'){
}
else {
if (create_new){
pylds_sum <- disease_life_table_list_sc[[index]][,age_sex_cols]
pylds_sum$total <- 0
create_new <- F
pylds_sum$total <- pylds_sum$total +
(disease_life_table_list_sc[[index]]$diff_pylds_disease)
}else{
pylds_sum$total <- pylds_sum$total +
(disease_life_table_list_sc[[index]]$diff_pylds_disease)
}
# cat(age, ' - ', sex,' - ',  disease,' - ',  index, ' - ', l_index,  '\n')
index <- index + 1
}
}
pylds_sc_total_disease[[l_index]] <- pylds_sum
names(pylds_sc_total_disease)[l_index] <- paste(iage, isex)
l_index <- l_index + 1
}
}
### Non-disease
pylds_sc_total_non_disease <- list()
l_index <- 1
index <- 1
for (iage in i_age_cohort){
for (isex in i_sex){
pylds_sum <- NULL
create_new <- T
for (d in 1:nrow(DISEASE_SHORT_NAMES)) {
if (isex == 'male' && (DISEASE_SHORT_NAMES$disease[d] %in% c('breast cancer', 'uterine cancer'))
|| DISEASE_SHORT_NAMES$is_not_dis[d] != 1 || DISEASE_SHORT_NAMES$acronym[d] == 'no_pif' || DISEASE_SHORT_NAMES$acronym[d] == 'other'){
}
else {
# print(paste(isex, DISEASE_SHORT_NAMES$disease[d]))
if (create_new){
pylds_sum <- non_disease_list[[index]][,age_sex_cols]
pylds_sum$total <- 0
create_new <- F
pylds_sum$total <- pylds_sum$total +
(non_disease_list[[index]]$diff_ylds)
}else{
pylds_sum$total <- pylds_sum$total +
(non_disease_list[[index]]$diff_ylds)
}
# cat(age, ' - ', sex,' - ',  disease,' - ',  index, ' - ', l_index,  '\n')
index <- index + 1
}
}
pylds_sc_total_non_disease[[l_index]] <- pylds_sum
names(pylds_sc_total_non_disease)[l_index] <- paste(iage, isex)
l_index <- l_index + 1
}
}
# ---- chunk-9 ----
## Calculate general life tables with modified mortality and pylds total
## Original mortality rate is modified by the mx_sc_total (total change in mortality from diseases)
## Original pyld rate is modified by the change in each disease pylds
general_life_table_list_sc <- list()
index <- 1
for (iage in i_age_cohort){
for (isex in i_sex){
# cat('age ', age, ' and sex ', sex, '\n')
# modify idata's mortality and pyld total for the said scenario
td2 <- MSLT_DF
# td2 <- subset(td2, select = -c(mx, pyld_rate))
td2[td2$age >= iage & td2$sex == isex,][[paste('mx')]] <- general_life_table_list_bl[[index]]$mx +
mx_sc_total_disease[[index]]$total +
mx_sc_total_non_disease[[index]]$total
td2[td2$age >= iage & td2$sex == isex,][[paste('pyld_rate')]] <- general_life_table_list_bl[[index]]$pyld_rate +
pylds_sc_total_disease[[index]]$total +
pylds_sc_total_non_disease[[index]]$total
# Instead of idata, feed td to run scenarios
general_life_table_list_sc[[index]] <- RunLifeTable(in_idata = td2, in_sex = isex, in_mid_age = iage)
#
names(general_life_table_list_sc)[index] <- paste(iage, isex, sep = '_')
index <- index + 1
}
}
# ---- chunk-10 ----
## In the following list 'output_life_table', 34 data frames are nested per age and sex cohort
## Outputs are generated following the index order of disease life tables baseline and scenarios where diabates is first calculated as it impacts on cardivascular diseases.
## In the following list 'output_life_table', 34 data frames are nested per age and sex cohort
## Outputs are generated following the index order of disease life tables baseline and scenarios where diabates is first calculated as it impacts on cardivascular diseases.
dia_index <- which(DISEASE_SHORT_NAMES$sname=='dmt2')
dia_order <- c(dia_index,c(1:nrow(DISEASE_SHORT_NAMES))[-dia_index])
output_burden <- list()
l_index <- 1
index <- 1
index_n <- 1
sc_cols <- which(colnames(disease_life_table_list_sc[[index]])%in%c('age', 'sex', 'incidence_disease', 'mx', 'px'))
bl_cols <- which(colnames(disease_life_table_list_bl[[index]])%in%c('incidence_disease', 'mx', 'px'))
l_sc_cols <- which(colnames(general_life_table_list_sc[[l_index]])%in%c('Lx', 'Lwx', 'ex', 'ewx'))
l_bl_cols <- which(colnames(general_life_table_list_bl[[l_index]])%in%c('Lx', 'Lwx', 'ex', 'ewx'))
for (iage in i_age_cohort){
for (isex in i_sex){
# We create a TRUE/FALSE variable for the loop to move into the next disease
create_new <- T
for (d in c(1:nrow(DISEASE_SHORT_NAMES))[dia_order]){
if (isex == 'male' && (DISEASE_SHORT_NAMES$disease[d] %in% c('breast cancer', 'uterine cancer'))
|| DISEASE_SHORT_NAMES$is_not_dis[d] != 0 || DISEASE_SHORT_NAMES$acronym[d] == 'no_pif' || DISEASE_SHORT_NAMES$acronym[d] == 'other'){
}
else {
if (create_new){
output_burden_sc <- output_burden_sc <- disease_life_table_list_sc[[index]][,sc_cols]
names(output_burden_sc)[names(output_burden_sc) == 'incidence_disease'] <-
paste('incidence_disease', DISEASE_SHORT_NAMES$sname[d], 'sc', sep = '_')
names(output_burden_sc)[names(output_burden_sc) == 'mx'] <-
paste('mx', DISEASE_SHORT_NAMES$sname[d], 'sc', sep = '_')
names(output_burden_sc)[names(output_burden_sc) == 'px'] <-
paste('px', DISEASE_SHORT_NAMES$sname[d], 'sc', sep = '_')
output_burden_bl <- disease_life_table_list_bl[[index]][,bl_cols]
names(output_burden_bl)[names(output_burden_bl) == 'incidence_disease'] <-
paste('incidence_disease', DISEASE_SHORT_NAMES$sname[d], 'bl', sep = '_')
names(output_burden_bl)[names(output_burden_bl) == 'mx'] <-
paste('mx', DISEASE_SHORT_NAMES$sname[d], 'bl', sep = '_')
names(output_burden_bl)[names(output_burden_bl) == 'px'] <-
paste('px', DISEASE_SHORT_NAMES$sname[d], 'bl', sep = '_')
## New list to add calculations for changes in burden of disease (incidence and mortality numbers)
output_burden_change <- list()
output_burden_change$inc_num_bl <- disease_life_table_list_bl[[index]]$incidence_disease *
(1 - disease_life_table_list_bl[[index]]$px) * general_life_table_list_bl[[l_index]]$Lx
output_burden_change$inc_num_sc <- disease_life_table_list_sc[[index]]$incidence_disease *
(1 - disease_life_table_list_sc[[index]]$px) * general_life_table_list_sc[[l_index]]$Lx
output_burden_change$inc_num_diff <- output_burden_change$inc_num_bl - output_burden_change$inc_num_sc
output_burden_change$mx_num_bl <- disease_life_table_list_bl[[index]]$mx * general_life_table_list_bl[[l_index]]$Lx
output_burden_change$mx_num_sc <- disease_life_table_list_sc[[index]]$mx * general_life_table_list_sc[[l_index]]$Lx
output_burden_change$mx_num_diff <- output_burden_change$mx_num_bl - output_burden_change$mx_num_sc
names(output_burden_change)[names(output_burden_change) == 'inc_num_bl'] <-
paste('inc_num_bl', DISEASE_SHORT_NAMES$sname[d], sep = '_')
names(output_burden_change)[names(output_burden_change) == 'inc_num_sc'] <-
paste('inc_num_sc', DISEASE_SHORT_NAMES$sname[d], sep = '_')
names(output_burden_change)[names(output_burden_change) == 'inc_num_diff'] <-
paste('inc_num_diff', DISEASE_SHORT_NAMES$sname[d], sep = '_')
names(output_burden_change)[names(output_burden_change) == 'mx_num_bl'] <-
paste('mx_num_bl', DISEASE_SHORT_NAMES$sname[d], sep = '_')
names(output_burden_change)[names(output_burden_change) == 'mx_num_sc'] <-
paste('mx_num_sc', DISEASE_SHORT_NAMES$sname[d], sep = '_')
names(output_burden_change)[names(output_burden_change) == 'mx_num_diff'] <-
paste('mx_num_diff', DISEASE_SHORT_NAMES$sname[d], sep = '_')
## Bind all lists
output_burden_sc <- cbind(output_burden_sc, output_burden_bl)
output_burden_sc <- cbind(output_burden_sc, output_burden_change)
create_new <- F
## Here the calculations above are repeated, here is where the F is telling to move into the next disease
}else{
td3 <- disease_life_table_list_sc[[index]][,colnames(disease_life_table_list_sc[[index]])%in%c('incidence_disease', 'mx', 'px')]
names(td3)[names(td3) == 'incidence_disease'] <-
paste('incidence_disease', DISEASE_SHORT_NAMES$sname[d], 'sc', sep = '_')
names(td3)[names(td3) == 'mx'] <-
paste('mx', DISEASE_SHORT_NAMES$sname[d], 'sc', sep = '_')
names(td3)[names(td3) == 'px'] <-
paste('px', DISEASE_SHORT_NAMES$sname[d], 'sc', sep = '_')
td4 <- disease_life_table_list_bl[[index]][,colnames(disease_life_table_list_bl[[index]])%in%c('incidence_disease', 'mx', 'px')]
names(td4)[names(td4) == 'incidence_disease'] <-
paste('incidence_disease', DISEASE_SHORT_NAMES$sname[d], 'bl', sep = '_')
names(td4)[names(td4) == 'mx'] <-
paste('mx', DISEASE_SHORT_NAMES$sname[d], 'bl', sep = '_')
names(td4)[names(td4) == 'px'] <-
paste('px', DISEASE_SHORT_NAMES$sname[d], 'bl', sep = '_')
output_burden_change2 <- list()
output_burden_change2$inc_num_bl <- disease_life_table_list_bl[[index]]$incidence_disease * (1 - disease_life_table_list_bl[[index]]$px) *
general_life_table_list_bl[[l_index]]$Lx
output_burden_change2$inc_num_sc <- disease_life_table_list_sc[[index]]$incidence_disease * (1 - disease_life_table_list_sc[[index]]$px) *
general_life_table_list_sc[[l_index]]$Lx
output_burden_change2$inc_num_diff <- output_burden_change2$inc_num_bl - output_burden_change2$inc_num_sc
output_burden_change2$mx_num_bl <- disease_life_table_list_bl[[index]]$mx * general_life_table_list_bl[[l_index]]$Lx
output_burden_change2$mx_num_sc <- disease_life_table_list_sc[[index]]$mx * general_life_table_list_sc[[l_index]]$Lx
output_burden_change2$mx_num_diff <- output_burden_change2$mx_num_bl - output_burden_change2$mx_num_sc
names(output_burden_change2)[names(output_burden_change2) == 'inc_num_bl'] <-
paste('inc_num_bl', DISEASE_SHORT_NAMES$sname[d], sep = '_')
names(output_burden_change2)[names(output_burden_change2) == 'inc_num_sc'] <-
paste('inc_num_sc', DISEASE_SHORT_NAMES$sname[d], sep = '_')
names(output_burden_change2)[names(output_burden_change2) == 'inc_num_diff'] <-
paste('inc_num_diff', DISEASE_SHORT_NAMES$sname[d], sep = '_')
names(output_burden_change2)[names(output_burden_change2) == 'mx_num_bl'] <-
paste('mx_num_bl', DISEASE_SHORT_NAMES$sname[d], sep = '_')
names(output_burden_change2)[names(output_burden_change2) == 'mx_num_sc'] <-
paste('mx_num_sc', DISEASE_SHORT_NAMES$sname[d], sep = '_')
names(output_burden_change2)[names(output_burden_change2) == 'mx_num_diff'] <-
paste('mx_num_diff', DISEASE_SHORT_NAMES$sname[d], sep = '_')
## Bind all lists
output_burden_sc <- cbind(output_burden_sc, td3)
output_burden_sc <- cbind(output_burden_sc, td4)
output_burden_sc$age_cohort <- iage
output_burden_sc <- cbind(output_burden_sc, output_burden_change2)
}
# cat(iage, ' - ', isex,' - ',  disease,' - ',  index, ' - ', l_index,  '\n')
index <- index + 1
}
}
#### Add non_diseases (injuires and lwri)
create_new <- T
for (d in 1:nrow(DISEASE_SHORT_NAMES)) {
if (DISEASE_SHORT_NAMES$is_not_dis[d] != 1 || DISEASE_SHORT_NAMES$acronym[d] == 'no_pif' || DISEASE_SHORT_NAMES$acronym[d] == 'other'){
}
else {
if (create_new){
td5 <- non_disease_list[[index_n]]
## Calculate numbers
# ## Variable names
#
mx_num_bl <- paste('mx_num_bl',DISEASE_SHORT_NAMES$acronym[d], sep = '_')
ylds_num_bl <- paste('ylds_num_bl',DISEASE_SHORT_NAMES$acronym[d], sep = '_')
mx_num_sc <- paste('mx_num_sc',DISEASE_SHORT_NAMES$acronym[d], sep = '_')
ylds_num_sc <- paste('ylds_num_sc',DISEASE_SHORT_NAMES$acronym[d], sep = '_')
### Baseline
td5[[mx_num_bl]] <- non_disease_list[[index_n]]$deaths_rate_bl *
general_life_table_list_bl[[l_index]]$Lx
td5[[ylds_num_bl]]<- non_disease_list[[index_n]]$ylds_rate_bl *
general_life_table_list_bl[[l_index]]$Lx
### Scenario
td5[[mx_num_sc]] <- non_disease_list[[index_n]]$deaths_rate_sc *
general_life_table_list_sc[[l_index]]$Lx
td5[[ylds_num_sc]] <- non_disease_list[[index_n]]$ylds_rate_sc *
general_life_table_list_bl[[l_index]]$Lx
output_burden_change3 <- list()
### Difference
output_burden_change3$mx_num_diff <- non_disease_list[[index_n]]$diff_mort * general_life_table_list_sc[[l_index]]$Lx
output_burden_change3$ylds_num_diff <- non_disease_list[[index_n]]$diff_ylds * general_life_table_list_sc[[l_index]]$Lx
### Change names rates to match each non_disease
names(output_burden_change3)[names(output_burden_change3) == 'diff_ylds'] <- paste('ylds_rate_diff', DISEASE_SHORT_NAMES$acronym[d], sep = '_')
names(output_burden_change3)[names(output_burden_change3) == 'diff_mort'] <- paste('deaths_rate_diff', DISEASE_SHORT_NAMES$acronym[d], sep = '_')
## Change names numbers to match non_disease
names(output_burden_change3)[names(output_burden_change3) == 'mx_num_diff'] <- paste('mx_num_diff', DISEASE_SHORT_NAMES$acronym[d], sep = '_')
names(output_burden_change3)[names(output_burden_change3) == 'ylds_num_diff'] <- paste('ylds_num_diff', DISEASE_SHORT_NAMES$acronym[d], sep = '_')
output_burden_sc <- cbind(output_burden_sc, td5)
output_burden_sc <- cbind(output_burden_sc, output_burden_change3)
create_new <- F
## Here the calculations above are repeated, here is where the F is telling to move into the next disease
}else{
td6 <- non_disease_list[[index_n]]
## Calculate numbers
# ## Variable names
#
mx_num_bl <- paste('mx_num_bl',DISEASE_SHORT_NAMES$acronym[d], sep = '_')
ylds_num_bl <- paste('ylds_num_bl',DISEASE_SHORT_NAMES$acronym[d], sep = '_')
mx_num_sc <- paste('mx_num_sc',DISEASE_SHORT_NAMES$acronym[d], sep = '_')
ylds_num_sc <- paste('ylds_num_sc',DISEASE_SHORT_NAMES$acronym[d], sep = '_')
### Baseline
td6[[mx_num_bl]] <- non_disease_list[[index_n]]$deaths_rate_bl *
general_life_table_list_bl[[l_index]]$Lx
td6[[ylds_num_bl]]<- non_disease_list[[index_n]]$ylds_rate_bl *
general_life_table_list_bl[[l_index]]$Lx
### Scenario
td6[[mx_num_sc]] <- non_disease_list[[index_n]]$deaths_rate_sc *
general_life_table_list_sc[[l_index]]$Lx
td6[[ylds_num_sc]] <- non_disease_list[[index_n]]$ylds_rate_sc *
general_life_table_list_bl[[l_index]]$Lx
output_burden_change4 <- list()
### Difference
output_burden_change4$mx_num_diff <- non_disease_list[[index_n]]$diff_mort * general_life_table_list_sc[[l_index]]$Lx
output_burden_change4$ylds_num_diff <- non_disease_list[[index_n]]$diff_ylds * general_life_table_list_sc[[l_index]]$Lx
### Change names rates to match each non_disease
names(output_burden_change4)[names(output_burden_change4) == 'diff_ylds'] <- paste('ylds_rate_diff', DISEASE_SHORT_NAMES$acronym[d], sep = '_')
names(output_burden_change4)[names(output_burden_change4) == 'diff_mort'] <- paste('deaths_rate_diff', DISEASE_SHORT_NAMES$acronym[d], sep = '_')
## Change names numbers to match non_disease
names(output_burden_change4)[names(output_burden_change4) == 'mx_num_diff'] <- paste('mx_num_diff', DISEASE_SHORT_NAMES$acronym[d], sep = '_')
names(output_burden_change4)[names(output_burden_change4) == 'ylds_num_diff'] <- paste('ylds_num_diff', DISEASE_SHORT_NAMES$acronym[d], sep = '_')
output_burden_sc <- cbind(output_burden_sc, td6)
output_burden_sc <- cbind(output_burden_sc, output_burden_change4)
}
index_n <- index_n + 1
}
}
## general_life_table_list_sc and general_life_table_list_bl (Lx)
output_burden_lf_sc <- general_life_table_list_sc[[l_index]][,l_sc_cols]
names(output_burden_lf_sc)[names(output_burden_lf_sc) == 'Lx'] <- paste('Lx', 'sc', sep = '_')
names(output_burden_lf_sc)[names(output_burden_lf_sc) == 'Lwx'] <- paste('Lwx', 'sc', sep = '_')
names(output_burden_lf_sc)[names(output_burden_lf_sc) == 'ex'] <- paste('ex', 'sc', sep = '_')
names(output_burden_lf_sc)[names(output_burden_lf_sc) == 'ewx'] <- paste('ewx', 'sc', sep = '_')
output_burden_lf_bl <- general_life_table_list_bl[[l_index]][,l_bl_cols]
names(output_burden_lf_bl)[names(output_burden_lf_bl) == 'Lx'] <- paste('Lx', 'bl', sep = '_')
names(output_burden_lf_bl)[names(output_burden_lf_bl) == 'Lwx'] <- paste('Lwx', 'bl', sep = '_')
names(output_burden_lf_bl)[names(output_burden_lf_bl) == 'ex'] <- paste('ex', 'bl', sep = '_')
names(output_burden_lf_bl)[names(output_burden_lf_bl) == 'ewx'] <- paste('ewx', 'bl', sep = '_')
### Difference in life years and health adjusted life years for all evey cohort year
output_burden_lf_sc$Lx_diff <- general_life_table_list_bl[[l_index]]$Lx - general_life_table_list_sc[[l_index]]$Lx
output_burden_lf_sc$Lwx_diff <- general_life_table_list_bl[[l_index]]$Lwx - general_life_table_list_sc[[l_index]]$Lwx
### Difference in life expectancy and health adjusted life expectancy for first year of cohort (show in results)
output_burden_lf_sc$ex_diff <- general_life_table_list_bl[[l_index]]$ex - general_life_table_list_sc[[l_index]]$ex
output_burden_lf_sc$ewx_diff <- general_life_table_list_bl[[l_index]]$ewx - general_life_table_list_sc[[l_index]]$ewx
output_burden_sc <- cbind(output_burden_sc, output_burden_lf_sc)
output_burden_sc <- cbind(output_burden_sc, output_burden_lf_bl)
output_burden[[l_index]] <- output_burden_sc
names(output_burden)[l_index] <- paste(iage, isex, sep = '_')
l_index <- l_index + 1
}
}
# ---- chunk-11-Outputs ----
## Generate a data frame for all results
output_df <- plyr::ldply(output_burden, rbind)
output_dir = paste0(relative_path_mslt,'output/')
#### Add within each outcome subfolders for each city region
# ---- chunk-11.1 Tables ----
### Create age groups variable, easier to read
output_df <-  output_df  %>%
separate(.id, c("Age group", "Gender"), "_", remove = FALSE)
output_df$`Age group` <- as.numeric(output_df$`Age group`)
output_df$`Age group`[output_df$`Age group` == 17] <-"16-19"
output_df$`Age group`[output_df$`Age group` == 22] <-"20-24"
output_df$`Age group`[output_df$`Age group` == 27] <-"25-29"
output_df$`Age group`[output_df$`Age group` == 32] <-"30-34"
output_df$`Age group`[output_df$`Age group` == 37] <-"35-39"
output_df$`Age group`[output_df$`Age group` == 42] <-"40-44"
output_df$`Age group`[output_df$`Age group` == 47] <-"45-49"
output_df$`Age group`[output_df$`Age group` == 52] <-"50-54"
output_df$`Age group`[output_df$`Age group` == 57] <-"55-59"
output_df$`Age group`[output_df$`Age group` == 62] <-"60-64"
output_df$`Age group`[output_df$`Age group` == 67] <-"65-69"
output_df$`Age group`[output_df$`Age group` == 72] <-"70-74"
output_df$`Age group`[output_df$`Age group` == 77] <-"75-79"
output_df$`Age group`[output_df$`Age group` == 82] <-"80-84"
output_df$`Age group`[output_df$`Age group` == 87] <-"85-89"
output_df$`Age group`[output_df$`Age group` == 92] <-"90-94"
output_df$`Age group`[output_df$`Age group` == 97] <-"95 plus"
# ---- chunk-11.1.1 Life expectancy and health adjusted life expectancy ----
#### Add uncertainty intervals
### Life expectancy is for year one of simulation. For example, change in life expectancy for a female aged 16-19.
output_life_expectancy_change <- output_df[!duplicated(output_df$.id), c("Age group", "Gender", "ex_bl", "ex_sc", "ewx_bl", "ewx_sc",
"ex_diff", "ewx_diff")] %>%
dplyr::rename(`Life expectancy at baseline` = ex_bl,
`Life expectancy scenario` = ex_sc,
`Health adjusted life expectancy baseline` = ewx_bl,
`Health adjusted life expectancy scenario` = ewx_sc,
`Difference in life expectancy` = ex_diff,
`Difference in health adjusted life expectancy` = ewx_diff) %>%
mutate_if(is.numeric, round, digits = 3)
output_life_expectancy_change <- output_life_expectancy_change[order(output_life_expectancy_change$Gender),]
saveRDS(output_life_expectancy_change, paste0(output_dir, "tables/life_expectancy/life_expectancy_change.Rds"))
# ---- chunk-11.1.2 Life years and health adjusted life years ----
#### Add uncertainty intervals
#### Accumulated over the life of the cohort. For example, total life years change for females 16-19 over their life course
output_life_years_change <- output_df %>%
group_by(Gender, `Age group`) %>%
summarise_if(is.numeric, funs(sum)) %>%
dplyr::select(`Age group`, Gender, Lx_diff, Lwx_diff) %>%
dplyr::rename(`Life years` = Lx_diff,
`Health adjusted life years` = Lwx_diff)  %>%
mutate_if(is.numeric, round)
saveRDS(output_life_years_change, paste0(output_dir, "tables/life_years/output_life_years_change.Rds"))
# ---- chunk-11.1.2 Diseases deaths, incidence and ylds (lri) ----
#### Add uncertainty intervals
#### Accumulated over the life of the cohort. For example, total life years change for females 16-19 over their life course
### Vector with diseases (may be a better way for this)
### hard coded matches, best not to
output_diseases_change <- output_df %>%
group_by(Gender, `Age group`) %>%
summarise_if(is.numeric, funs(sum)) %>%
dplyr::select(`Age group`, Gender, matches("diff_dmt2|diff_ishd|diff_strk|diff_carc|diff_copd|diff_tbalc|diff_brsc|diff_utrc|diff_lri"))
saveRDS(output_diseases_change, paste0(output_dir, "tables/diseases/output_diseases_change.Rds"))
# ---- chunk-11.1.3 Injuries deaths and ylds ----
#### Add uncertainty intervals
#### Accumulated over the life of the cohort. For example, total life years change for females 16-19 over their life course
### Vector with diseases (may be a better way for this)
### hard coded matches, best not to
output_injuries_change <- output_df %>%
group_by(Gender, `Age group`) %>%
summarise_if(is.numeric, funs(sum)) %>%
dplyr::select(`Age group`, Gender, matches("diff_pedestrian|diff_cyclist|diff_motorcyclist|diff_motor"))
View(DISEASE_SHORT_NAMES)
DISEASE_SHORT_NAMES$disease
